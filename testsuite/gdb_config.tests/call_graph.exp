set debug_commands ""
set debug_out ""
lappend debug_commands "inferior $debug_inferior"
lappend debug_commands "start 10"
lappend debug_commands "call-graph init .*"
lappend debug_commands "info call-graph"
lappend debug_out "Functions currently traced by call-graph:"
lappend debug_out "	 create_tree"
lappend debug_out "	 free_tree"
lappend debug_out "	 insert_entry"
lappend debug_out "	 main"
lappend debug_out "	 create_random_tree"
check_so_far "Debug finds all functions with info" debug_commands debug_out

lappend debug_commands "info call-graph exact"
lappend debug_out "Functions currently traced by call-graph:"
lappend debug_out "	 0x40089d"
lappend debug_out "	 0x40085c"
lappend debug_out "	 0x400776"
lappend debug_out "	 0x400954"
lappend debug_out "	 0x4008cb"
check_so_far "Debug shows exact position" debug_commands debug_out

lappend debug_commands "call-graph update - free_tree"
lappend debug_commands "info call-graph"
lappend debug_out "Functions currently traced by call-graph:"
lappend debug_out "	 create_tree"
lappend debug_out "	 insert_entry"
lappend debug_out "	 main"
lappend debug_out "	 create_random_tree"
check_so_far "Debug call-graph update removes functions" debug_commands debug_out

lappend debug_commands "call-graph update + free_tree"
lappend debug_commands "info call-graph"
lappend debug_out "Functions currently traced by call-graph:"
lappend debug_out "	 create_tree"
lappend debug_out "	 insert_entry"
lappend debug_out "	 main"
lappend debug_out "	 create_random_tree"
lappend debug_out "	 free_tree"
check_so_far "Debug call-graph update adds functions" debug_commands debug_out

lappend debug_commands "cont"
lappend debug_out "Continuing."
lappend debug_out "     --> create_random_tree"
lappend debug_out "         --> create_tree"
lappend debug_out "         <-- create_tree+45"
lappend debug_out "         --> insert_entry"
lappend debug_out "         <-- insert_entry+229"
lappend debug_out "         --> insert_entry"
lappend debug_out "         <-- insert_entry+229"
lappend debug_out "         --> insert_entry"
lappend debug_out "         <-- insert_entry+229"
lappend debug_out "         --> insert_entry"
lappend debug_out "         <-- insert_entry+229"
lappend debug_out "         --> insert_entry"
lappend debug_out "         <-- insert_entry+229"
lappend debug_out "         --> insert_entry"
lappend debug_out "         <-- insert_entry+229"
lappend debug_out "         --> insert_entry"
lappend debug_out "         <-- insert_entry+229"
lappend debug_out "         --> insert_entry"
lappend debug_out "         <-- insert_entry+229"
lappend debug_out "         --> insert_entry"
lappend debug_out "         <-- insert_entry+229"
lappend debug_out "         --> insert_entry"
lappend debug_out "         <-- insert_entry+229"
lappend debug_out "     <-- create_random_tree+136"
lappend debug_out "     --> free_tree"
lappend debug_out "         --> free_tree"
lappend debug_out "             --> free_tree"
lappend debug_out "                 --> free_tree"
lappend debug_out "                 <-- free_tree+64"
lappend debug_out "                 --> free_tree"
lappend debug_out "                 <-- free_tree+64"
lappend debug_out "             <-- free_tree+64"
lappend debug_out "             --> free_tree"
lappend debug_out "                 --> free_tree"
lappend debug_out "                 <-- free_tree+64"
lappend debug_out "                 --> free_tree"
lappend debug_out "                 <-- free_tree+64"
lappend debug_out "             <-- free_tree+64"
lappend debug_out "         <-- free_tree+64"
lappend debug_out "         --> free_tree"
lappend debug_out "             --> free_tree"
lappend debug_out "             <-- free_tree+64"
lappend debug_out "             --> free_tree"
lappend debug_out "                 --> free_tree"
lappend debug_out "                     --> free_tree"
lappend debug_out "                         --> free_tree"
lappend debug_out "                         <-- free_tree+64"
lappend debug_out "                         --> free_tree"
lappend debug_out "                             --> free_tree"
lappend debug_out "                             <-- free_tree+64"
lappend debug_out "                             --> free_tree"
lappend debug_out "                             <-- free_tree+64"
lappend debug_out "                         <-- free_tree+64"
lappend debug_out "                     <-- free_tree+64"
lappend debug_out "                     --> free_tree"
lappend debug_out "                     <-- free_tree+64"
lappend debug_out "                 <-- free_tree+64"
lappend debug_out "                 --> free_tree"
lappend debug_out "                     --> free_tree"
lappend debug_out "                         --> free_tree"
lappend debug_out "                         <-- free_tree+64"
lappend debug_out "                         --> free_tree"
lappend debug_out "                         <-- free_tree+64"
lappend debug_out "                     <-- free_tree+64"
lappend debug_out "                     --> free_tree"
lappend debug_out "                     <-- free_tree+64"
lappend debug_out "                 <-- free_tree+64"
lappend debug_out "             <-- free_tree+64"
lappend debug_out "         <-- free_tree+64"
lappend debug_out "     <-- free_tree+64"
lappend debug_out " <-- main+117"
check_so_far "Debug call-graph traces function calls" debug_commands debug_out
wait_for_exit "debug call-graph"

lappend debug_commands "call-graph update + free_tree"
lappend debug_out "No frame is currently selected."
check_so_far "Debug call-graph adding elements gives reasonable error" debug_commands debug_out

lappend debug_commands "call-graph clear"
lappend debug_commands "info call-graph"
lappend debug_out "Functions currently traced by call-graph:"
lappend debug_out "(gdb) "
check_so_far "Debug can clear call-graph tracers" debug_commands debug_out


unset debug_out
unset debug_commands


set plain_commands ""
set plain_out ""
lappend plain_commands "inferior $plain_inferior"
lappend plain_commands "start 10"
lappend plain_commands "call-graph init .*"
lappend plain_commands "info call-graph"
lappend plain_out "Functions currently traced by call-graph:"
lappend plain_out "(gdb)"
check_so_far "Plain doesn't find functions by default" plain_commands plain_out

lappend plain_commands "set call-graph-nondebug on"
lappend plain_commands "set call-graph-dynlibs on"
lappend plain_commands "call-graph init (free_tree|insert_entry|create_tree|create_random_tree|main)"
lappend plain_commands "info call-graph"
# TODO Figure out how to check all functions are found, no others are found,
# but not rely on the order.
lappend plain_out "Functions currently traced by call-graph:"
lappend plain_out "	 insert_entry"
lappend plain_out "	 free_tree"
lappend plain_out "	 create_tree"
lappend plain_out "	 create_random_tree"
lappend plain_out "	 main"
lappend plain_out "	 free_tree"
check_so_far "Plain finds correct functions including dynlibs" plain_commands plain_out

lappend plain_commands "call-graph update - free_tree"
lappend plain_commands "info call-graph"
lappend plain_out "Functions currently traced by call-graph:"
lappend plain_out "	 insert_entry"
lappend plain_out "	 create_tree"
lappend plain_out "	 create_random_tree"
lappend plain_out "	 main"
check_so_far "Plain call-graph update removes functions" plain_commands plain_out

lappend plain_commands "set call-graph-dynlibs off"
lappend plain_commands "call-graph update + free_tree"
lappend plain_commands "info call-graph"
lappend plain_out "Functions currently traced by call-graph:"
lappend plain_out "	 insert_entry"
lappend plain_out "	 create_tree"
lappend plain_out "	 create_random_tree"
lappend plain_out "	 main"
lappend plain_out "	 free_tree"
check_so_far "Plain call-graph update adds functions" plain_commands plain_out

lappend plain_commands "info call-graph exact"
lappend plain_out "Functions currently traced by call-graph:"
lappend plain_out "	 0x400776"
lappend plain_out "	 0x40089d"
lappend plain_out "	 0x4008cb"
lappend plain_out "	 0x400954"
lappend plain_out "	 0x40085c"
check_so_far "Plain shows exact position" plain_commands plain_out

lappend plain_commands "cont"
lappend plain_out "Continuing."
lappend plain_out "     --> create_random_tree"
lappend plain_out "         --> create_tree"
lappend plain_out "         <-- create_tree+45"
lappend plain_out "         --> insert_entry"
lappend plain_out "         <-- insert_entry+229"
lappend plain_out "         --> insert_entry"
lappend plain_out "         <-- insert_entry+229"
lappend plain_out "         --> insert_entry"
lappend plain_out "         <-- insert_entry+229"
lappend plain_out "         --> insert_entry"
lappend plain_out "         <-- insert_entry+229"
lappend plain_out "         --> insert_entry"
lappend plain_out "         <-- insert_entry+229"
lappend plain_out "         --> insert_entry"
lappend plain_out "         <-- insert_entry+229"
lappend plain_out "         --> insert_entry"
lappend plain_out "         <-- insert_entry+229"
lappend plain_out "         --> insert_entry"
lappend plain_out "         <-- insert_entry+229"
lappend plain_out "         --> insert_entry"
lappend plain_out "         <-- insert_entry+229"
lappend plain_out "         --> insert_entry"
lappend plain_out "         <-- insert_entry+229"
lappend plain_out "     <-- create_random_tree+136"
lappend plain_out "     --> free_tree"
lappend plain_out "         --> free_tree"
lappend plain_out "             --> free_tree"
lappend plain_out "                 --> free_tree"
lappend plain_out "                 <-- free_tree+64"
lappend plain_out "                 --> free_tree"
lappend plain_out "                 <-- free_tree+64"
lappend plain_out "             <-- free_tree+64"
lappend plain_out "             --> free_tree"
lappend plain_out "                 --> free_tree"
lappend plain_out "                 <-- free_tree+64"
lappend plain_out "                 --> free_tree"
lappend plain_out "                 <-- free_tree+64"
lappend plain_out "             <-- free_tree+64"
lappend plain_out "         <-- free_tree+64"
lappend plain_out "         --> free_tree"
lappend plain_out "             --> free_tree"
lappend plain_out "             <-- free_tree+64"
lappend plain_out "             --> free_tree"
lappend plain_out "                 --> free_tree"
lappend plain_out "                     --> free_tree"
lappend plain_out "                         --> free_tree"
lappend plain_out "                         <-- free_tree+64"
lappend plain_out "                         --> free_tree"
lappend plain_out "                             --> free_tree"
lappend plain_out "                             <-- free_tree+64"
lappend plain_out "                             --> free_tree"
lappend plain_out "                             <-- free_tree+64"
lappend plain_out "                         <-- free_tree+64"
lappend plain_out "                     <-- free_tree+64"
lappend plain_out "                     --> free_tree"
lappend plain_out "                     <-- free_tree+64"
lappend plain_out "                 <-- free_tree+64"
lappend plain_out "                 --> free_tree"
lappend plain_out "                     --> free_tree"
lappend plain_out "                         --> free_tree"
lappend plain_out "                         <-- free_tree+64"
lappend plain_out "                         --> free_tree"
lappend plain_out "                         <-- free_tree+64"
lappend plain_out "                     <-- free_tree+64"
lappend plain_out "                     --> free_tree"
lappend plain_out "                     <-- free_tree+64"
lappend plain_out "                 <-- free_tree+64"
lappend plain_out "             <-- free_tree+64"
lappend plain_out "         <-- free_tree+64"
lappend plain_out "     <-- free_tree+64"
lappend plain_out " <-- main+117"
check_so_far "Plain call-graph traces function calls" plain_commands plain_out
wait_for_exit "plain call-graph"

lappend plain_commands "call-graph update + free_tree"
lappend plain_out "No frame is currently selected."
check_so_far "Plain call-graph adding elements gives reasonable error" plain_commands plain_out

lappend plain_commands "call-graph clear"
lappend plain_commands "info call-graph"
lappend plain_out "Functions currently traced by call-graph:"
lappend plain_out "(gdb) "
check_so_far "Plain can clear call-graph tracers" plain_commands plain_out

unset plain_out
unset plain_commands

